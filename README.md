# Ekb_UrFU_SBER_2025
Камера с известным фиксированным широкоугольным полем зрения в надир

Файл dp1140.py - это алгоритм повышения точности возвращения БЛА в HOME и определения вектора скорости и ветра.

Задача 1: повышение точности возвращения БЛА в HOME

**Техническое разъяснение алгоритма коррекции траектории БЛА**

-----------------------------------------------------------------------
**Общая архитектура системы:**

graph TD
    A[Входные видео] --> B[Извлечение кадров]
    B --> C[Обработка изображений]
    C --> D[Анализ признаков]
    D --> E[Расчёт метрик]
    E --> F[Формирование рекомендаций]
    F --> G[Выходной отчёт]
    
-----------------------------------------------------------------------
**Класс SimpleKalmanFilter**

**Назначение:** Сглаживание шумов в измерениях оптического потока
**Математическая модель:**

x̂ₖ = x̂ₖ₋₁ + Kₖ(zₖ - x̂ₖ₋₁)
Kₖ = Pₖ₋₁ / (Pₖ₋₁ + R)
Pₖ = (1 - Kₖ)Pₖ₋₁ + Q

Q (process_noise): Дисперсия ошибки модели (0.01)
R (measurement_noise): Дисперсия ошибки измерения (0.1)
Применение: Сглаживание угла и магнитуды оптического потока

-----------------------------------------------------------------------
**Инициализация VGG модели**

def init_vgg_model():
    base_model = VGG16(weights='imagenet', include_top=False)
    return Model(inputs=base_model.input, outputs=base_model.get_layer('block5_pool').output)

**Архитектурные особенности:**

Использует слой 'block5_pool' (512 выходных карт признаков)
Размер входного изображения: 224×224 пикселя
**Предобработка:** *tf.keras.applications.vgg16.preprocess_input*

-----------------------------------------------------------------------
**Расчёт оптического потока (Farneback метод)**

**Математическая основа:**

I(x,t) = I(x + d(x,t), t + dt)
d(x,t) ≈ [u v]ᵀ

**Параметры алгоритма:**

pyr_scale=0.5: Масштаб пирамиды изображений
levels=5: Количество уровней пирамиды
winsize=25: Размер окна для полиномиальной аппроксимации
iterations=10: Количество итераций уточнения
poly_n=7: Размер полиномиальной аппроксимации
poly_sigma=1.5: Стандартное отклонение Гауссова фильтра

-----------------------------------------------------------------------
**Векторные расчёты**

**Вектор скорости спутника:**

v_x = v · cos(θ) · cos(ψ)
v_y = v · cos(θ) · sin(ψ)
v_z = v · sin(θ)

**Где:**

θ (pitch): Угол тангажа
ψ (yaw): Угол рыскания
v: Абсолютная скорость

**Вектор ветра:**

w_x = w · cos(φ)
w_y = w · sin(φ)
w_z = 0

**Где:**

w: Скорость ветра
φ: Направление ветра (градусы)

-----------------------------------------------------------------------
**Детекция горизонта**

**Алгоритм:**

Преобразование в градации серого
Гауссово размытие (ядро 5×5)
Выделение граней (Canny детектор)
Поиск линий (HoughLinesP)
Фильтрация линий:
Угол наклона |α| < 30°
Длина линии > 100 пикселей
Расчёт медианного угла

-----------------------------------------------------------------------
**Генерация рекомендаций**

**Логика коррекции:**

graph LR
    S[Схожесть] -->|>30%| N[Норма]
    S -->|25-30%| M[Умеренно]
    S -->|20-25%| H[Значительно]
    S -->|<20%| C[Критично]

**Формулы коррекции:**

Yaw: -α · (1 - similarity/100)
Roll: -β · 0.7 (β - угол горизонта)
Pitch: (alt-100)·0.01 + (vel-15)·0.05 + (temp-20)·0.002
Wind: w · 0.3 · sin(α)

-----------------------------------------------------------------------
**Обработка видео**

**Алгоритм:**

while True:
    frame_a2b = read_frame(video1)
    frame_b2a = read_frame(video2)
    frame_b2a = rotate_180(frame_b2a)
    
    features1 = VGG_features(frame_a2b)
    features2 = VGG_features(frame_b2a)
    
    similarity = cosine_similarity(features1, features2)
    flow = optical_flow(prev_frame, current_frame)
    env = generate_environment_data(time)
    
    if prev_frame_exists:
        flow = kalman_filter(flow)
    
    command = generate_command(similarity, flow, env)
    save_to_file(command)

-----------------------------------------------------------------------
**Фильтр Савицкого-Голея**

**Назначение:** Сглаживание данных без потери информации

**Формула:**

ŷᵢ = Σ aₖ · yᵢ₊ₖ

**Где:**

*aₖ:* Коэффициенты полинома
*window_length:* Длина окна сглаживания
*polyorder:* Порядок полинома

**Применение:** Сглаживание временных рядов (например, параметров траектории)

-----------------------------------------------------------------------
**Полная схема обработки данных**

sequenceDiagram
    participant VideoSource
    participant Processing
    participant FeatureExtractor
    participant Analysis
    participant Output
    
    VideoSource->>Processing: Кадры видео
    Processing->>FeatureExtractor: Преобразование изображений
    FeatureExtractor->>Analysis: Векторы признаков
    Analysis->>Analysis: Расчёт сходства (косинусное)
    Analysis->>Analysis: Оптический поток
    Analysis->>Analysis: Фильтрация (Калмана\Савицкого-Голея)
    Analysis->>Output: Формирование рекомендаций



**Система обеспечивает комплексный анализ траектории с учётом визуальных, динамических и средовых факторов, формируя детализированные рекомендации для коррекции полёта.**






